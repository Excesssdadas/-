{% extends 'store/base.html' %}

{% block title %}–ö–∞—Ç–∞–ª–æ–≥ –∏–≥—Ä - Game Store{% endblock %}

{% block content %}
<h1>–ö–∞—Ç–∞–ª–æ–≥ –∏–≥—Ä</h1>

<div class="filters">
    <form method="get" action="{% url 'game_list' %}">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
            <div class="filter-group">
                <label for="search">–ü–æ–∏—Å–∫:</label>
                <input type="text" id="search" name="search" value="{{ search_query }}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã...">
            </div>
            
            <div class="filter-group">
                <label for="genre">–ñ–∞–Ω—Ä:</label>
                <select id="genre" name="genre">
                    <option value="">–í—Å–µ –∂–∞–Ω—Ä—ã</option>
                    {% for genre in genres %}
                    <option value="{{ genre.id }}" {% if selected_genre == genre.id|stringformat:"i" %}selected{% endif %}>
                        {{ genre.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="filter-group">
                <label for="tag">–¢–µ–≥:</label>
                <select id="tag" name="tag">
                    <option value="">–í—Å–µ —Ç–µ–≥–∏</option>
                    {% for tag in tags %}
                    <option value="{{ tag.id }}" {% if selected_tag == tag.id|stringformat:"i" %}selected{% endif %}>
                        {{ tag.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="filter-group">
                <label for="sort">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
                <select id="sort" name="sort">
                    <option value="title" {% if sort_by == 'title' %}selected{% endif %}>–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–ê-–Ø)</option>
                    <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                    <option value="price_asc" {% if sort_by == 'price_asc' %}selected{% endif %}>–¶–µ–Ω–∞ (–ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é)</option>
                    <option value="price_desc" {% if sort_by == 'price_desc' %}selected{% endif %}>–¶–µ–Ω–∞ (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)</option>
                </select>
            </div>
        </div>
        
        <div style="margin-top: 20px; display: flex; gap: 10px;">
            <button type="submit" class="btn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
            <a href="{% url 'game_list' %}" class="btn btn-danger">–°–±—Ä–æ—Å–∏—Ç—å</a>
        </div>
    </form>
</div>

{% if games %}
<div class="games-grid">
    {% for game in games %}
    <div class="game-card">
        {% if game.image %}
        <img src="{{ game.image.url }}" alt="{{ game.title }}" class="game-image">
        {% else %}
        <div class="game-image" style="background: #667eea; display: flex; align-items: center; justify-content: center; color: white;">
            üéÆ
        </div>
        {% endif %}
        <div class="game-info">
            <h3 class="game-title">{{ game.title }}</h3>
            <p><strong>–ñ–∞–Ω—Ä:</strong> {{ game.genre.name }}</p>
            <p><strong>–¢–µ–≥–∏:</strong> 
                {% for tag in game.tags.all %}
                <span style="background: #f0f0f0; padding: 2px 5px; border-radius: 3px; font-size: 0.9rem; margin-right: 5px;">
                    {{ tag.name }}
                </span>
                {% endfor %}
            </p>
            <p><strong>–í –Ω–∞–ª–∏—á–∏–∏:</strong> {{ game.quantity }} —à—Ç.</p>
            <p class="game-price">{{ game.price }} ‚ÇΩ</p>
            <div style="display: flex; gap: 10px;">
                <a href="{% url 'game_detail' game.id %}" class="btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                {% if game.quantity > 0 %}
                <form action="{% url 'add_to_cart' game.id %}" method="post" style="margin: 0;">
                    {% csrf_token %}
                    <button type="submit" class="btn">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                </form>
                {% else %}
                <button class="btn" disabled>–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</button>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div style="text-align: center; padding: 40px; background: white; border-radius: 8px;">
    <p style="font-size: 1.2rem;">–ò–≥—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã.</p>
</div>
{% endif %}
{% endblock %}