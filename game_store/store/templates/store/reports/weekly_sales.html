{% extends 'store/base.html' %}

{% block title %}–ü—Ä–æ–¥–∞–∂–∏ –∑–∞ –Ω–µ–¥–µ–ª—é - Game Store{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
    <h1>üìÖ –ü—Ä–æ–¥–∞–∂–∏ –∑–∞ –Ω–µ–¥–µ–ª—é</h1>
    <div>
        <a href="{% url 'reports' %}" class="btn" style="background: #6c757d;">‚Üê –ù–∞–∑–∞–¥ –∫ –æ—Ç—á–µ—Ç–∞–º</a>
    </div>
</div>

<div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px;">
    <h3>–ü–µ—Ä–∏–æ–¥: {{ week_start }} - {{ week_end }}</h3>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; text-align: center;">
            <div style="font-size: 0.9rem; color: #1976d2;">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
            <div style="font-size: 2rem; font-weight: bold; color: #1976d2;">
                {{ total_sales.total_orders|default:0 }}
            </div>
        </div>
        
        <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; text-align: center;">
            <div style="font-size: 0.9rem; color: #2e7d32;">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</div>
            <div style="font-size: 2rem; font-weight: bold; color: #2e7d32;">
                {{ total_sales.total_amount|default:0|floatformat:2 }} ‚ÇΩ
            </div>
        </div>
        
        <div style="background: #fff3e0; padding: 15px; border-radius: 8px; text-align: center;">
            <div style="font-size: 0.9rem; color: #f57c00;">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</div>
            <div style="font-size: 2rem; font-weight: bold; color: #f57c00;">
                {% if total_sales.total_orders %}
                    {{ total_sales.total_amount|default:0|floatformat:0|divisibleby:total_sales.total_orders|floatformat:2 }} ‚ÇΩ
                {% else %}
                    0 ‚ÇΩ
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
    <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
        <div>
            <h3>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤</h3>
            <p>–í—Å–µ –ø–æ–∫—É–ø–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</p>
        </div>
        <div style="display: flex; gap: 10px;">
            <a href="?format=json" class="btn" style="background: #6c757d;">–°–∫–∞—á–∞—Ç—å JSON</a>
            <a href="?format=csv" class="btn" style="background: #28a745;">–°–∫–∞—á–∞—Ç—å CSV</a>
        </div>
    </div>

    {% if weekly_sales %}
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #667eea; color: white;">
                    <th style="padding: 12px; text-align: left;">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th>
                    <th style="padding: 12px; text-align: left;">–ó–∞–∫–∞–∑ ‚Ññ</th>
                    <th style="padding: 12px; text-align: left;">–ö–ª–∏–µ–Ω—Ç</th>
                    <th style="padding: 12px; text-align: center;">–ö–æ–ª-–≤–æ —Ç–æ–≤–∞—Ä–æ–≤</th>
                    <th style="padding: 12px; text-align: right;">–°—É–º–º–∞</th>
                    <th style="padding: 12px; text-align: center;">–°—Ç–∞—Ç—É—Å</th>
                </tr>
            </thead>
            <tbody>
                {% for order in weekly_sales %}
                <tr style="border-bottom: 1px solid #f0f0f0;">
                    <td style="padding: 12px;">
                        {{ order.created_at|date:"d.m.Y H:i" }}
                    </td>
                    <td style="padding: 12px;">
                        <a href="/admin/store/order/{{ order.id }}/change/" target="_blank" style="color: #667eea;">
                            #{{ order.id }}
                        </a>
                    </td>
                    <td style="padding: 12px;">
                        {{ order.customer.user.username }}
                    </td>
                    <td style="padding: 12px; text-align: center;">
                        {{ order.items_count }}
                    </td>
                    <td style="padding: 12px; text-align: right; font-weight: bold;">
                        {{ order.total_amount }} ‚ÇΩ
                    </td>
                    <td style="padding: 12px; text-align: center;">
                        <span style="
                            padding: 4px 8px;
                            border-radius: 4px;
                            font-size: 0.9rem;
                            {% if order.status == 'completed' %}
                                background: #d4edda;
                                color: #155724;
                            {% elif order.status == 'pending' %}
                                background: #fff3cd;
                                color: #856404;
                            {% else %}
                                background: #f8d7da;
                                color: #721c24;
                            {% endif %}
                        ">
                            {{ order.get_status_display }}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <div style="margin-top: 30px; display: flex; justify-content: space-between; align-items: center;">
        <div>
            <p><strong>–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤:</strong> {{ weekly_sales|length }}</p>
        </div>
        <div>
            <button onclick="window.print()" class="btn" style="background: #17a2b8;">
                üñ®Ô∏è –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –æ—Ç—á–µ—Ç
            </button>
        </div>
    </div>
    {% else %}
    <div style="text-align: center; padding: 40px;">
        <p style="font-size: 1.2rem;">–ù–µ—Ç –ø—Ä–æ–¥–∞–∂ –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</p>
    </div>
    {% endif %}
</div>

<div style="margin-top: 30px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
    <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h3>
    <ul style="margin-top: 10px;">
        <li><strong>–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤:</strong> {{ total_sales.total_orders|default:0 }}</li>
        <li><strong>–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞:</strong> {{ total_sales.total_amount|default:0|floatformat:2 }} ‚ÇΩ</li>
        <li><strong>–°—Ä–µ–¥–Ω–∏–π —á–µ–∫:</strong> 
            {% if total_sales.total_orders %}
                {{ total_sales.total_amount|default:0|floatformat:0|divisibleby:total_sales.total_orders|floatformat:2 }} ‚ÇΩ
            {% else %}
                0 ‚ÇΩ
            {% endif %}
        </li>
    </ul>
</div>
{% endblock %}